# 关于加密

## https通信过程
https://zhuanlan.zhihu.com/p/87102807

步骤 1： 客户端通过发送 Client Hello 报文开始 SSL 通信。报文中包含客户端支持的 SSL 的指定版本、加密组件（Cipher Suite）列表（所使用的加密算法及密钥长度等）。

步骤 2： 服务器可进行 SSL 通信时，会以 Server Hello 报文作为应答。和客户端一样，在报文中包含 SSL 版本以及加密组件。服务器的加密组件内容是从接收到的客户端加密组件内筛选出来的。

步骤 3： 之后服务器发送 Certificate 报文。报文中包含公开密钥证书。

步骤 4： 最后服务器发送 Server Hello Done 报文通知客户端，最初阶段的 SSL 握手协商部分结束。

步骤 5： SSL 第一次握手结束之后，客户端以 Client Key Exchange 报文作为回应。报文中包含通信加密中使用的一种被称为 Pre-mastersecret 的随机密码串。该报文已用步骤 3 中的公开密钥进行加密。

步骤 6： 接着客户端继续发送 Change Cipher Spec 报文。该报文会提示服务器，在此报文之后的通信会采用 Pre-master secret 密钥加密。

步骤 7： 客户端发送 Finished 报文。该报文包含连接至今全部报文的整体校验值。这次握手协商是否能够成功，要以服务器是否能够正确解密该报文作为判定标准。

步骤 8： 服务器同样发送 Change Cipher Spec 报文。

步骤 9： 服务器同样发送 Finished 报文。

## 一般客户端登录加密
### 如何安全传输用户登录密码？
#### ❌ client -> RSA -> server
会被中间人攻击窃取明文密码

#### ✅ client -> 混淆/加密(AES) -> RSA -> server
我们APP对密码进行了简单混淆，破解难度较低，加上对称加密或特定的哈希算法进行混淆可以更好保护明文密码在通信过程被窃取。
另外登录密钥可携带时间戳等信息，作登录日志。

### 如何客户端与服务端进行安全会话
会话内容使用对称加密，密钥不能使用用户登录密码，频繁使用登录密码增加被窃取的风险。
参照https的安全加密流程，使用随机密钥作为报文对称加密密钥，访问与登录互斥。

### 会话对称加密密钥安全传输
#### 1. 使用RSA加密传输
#### 2. 使用对称加密方式
好处：节省一次非对称加密的消耗
将加密因子salt放在登录密码加密串中，解密登录密码后，即可解密会话密钥。



